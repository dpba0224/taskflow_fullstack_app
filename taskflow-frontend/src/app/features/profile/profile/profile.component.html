<div class="profile-container">
  <div class="profile-header">
    <h1 class="profile-title">Profile</h1>
    <p class="profile-subtitle">Manage your personal information and account preferences.</p>
  </div>

  @if (success()) {
    <div class="alert alert-success">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
      {{ success() }}
    </div>
  }
  @if (error()) {
    <div class="alert alert-error">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v4M12 16h.01"/></svg>
      {{ error() }}
    </div>
  }

  <!-- Avatar section -->
  <div class="profile-card avatar-section">
    <div class="avatar-row">
      <div class="avatar-upload-wrapper" (click)="avatarInput.click()">
        @if (auth.user()?.avatar) {
          <img [src]="auth.user()!.avatar" alt="Profile picture" class="user-avatar-img">
        } @else {
          <span class="user-avatar">
            {{ auth.user()?.firstName?.charAt(0) }}{{ auth.user()?.lastName?.charAt(0) }}
          </span>
        }
        <div class="avatar-overlay">
          @if (uploadingAvatar()) {
            <span class="avatar-spinner"></span>
          } @else {
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
          }
        </div>
        <input #avatarInput type="file" accept="image/*" class="hidden-input" (change)="onAvatarFileSelected($event)">
      </div>
      <div class="avatar-info">
        <p class="avatar-name">{{ auth.user()?.firstName }} {{ auth.user()?.lastName }}</p>
        <p class="avatar-email">{{ auth.user()?.email }}</p>
        <p class="avatar-hint">Click photo to change</p>
      </div>
    </div>
  </div>

  <!-- Profile form -->
  <div class="profile-card">
    <div class="card-section-header">
      <h2>Personal Information</h2>
    </div>
    <div class="card-divider"></div>
    <form (ngSubmit)="updateProfile()" class="profile-form">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">First name</label>
          <input type="text" [(ngModel)]="firstName" name="firstName" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label">Last name</label>
          <input type="text" [(ngModel)]="lastName" name="lastName" class="form-input">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" [value]="auth.user()?.email" disabled class="form-input disabled">
      </div>
      <button type="submit" class="save-btn">Save Changes</button>
    </form>
  </div>

  <!-- Password change -->
  <div class="profile-card">
    <div class="card-section-header">
      <h2>Change Password</h2>
    </div>
    <div class="card-divider"></div>
    <form (ngSubmit)="changePassword()" class="profile-form">
      <div class="form-group">
        <label class="form-label">Current password</label>
        <input type="password" [(ngModel)]="currentPassword" name="currentPassword" class="form-input">
      </div>
      <div class="form-group">
        <label class="form-label">New password</label>
        <input type="password" [(ngModel)]="newPassword" name="newPassword" class="form-input"
          placeholder="Minimum 8 characters">
      </div>
      <button type="submit" class="save-btn">Update Password</button>
    </form>
  </div>
</div>
